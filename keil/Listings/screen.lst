


ARM Macro Assembler    Page 1 


    1 00000000         ; drive the screen
    2 00000000         ; assumes SSI0 at port A.
    3 00000000         ; screen pins:
    4 00000000         ; RST->PA7
    5 00000000         ; CE ->PA3
    6 00000000         ; DC ->PA6
    7 00000000         ; DIN->PA5
    8 00000000         ; CLK->PA2
    9 00000000         
   10 00000000 400FE61C 
                       RCGCSSI EQU              0x400FE61C
   11 00000000 400FEA1C 
                       PRSSI   EQU              0x400FEA1C
   12 00000000 400FE608 
                       RCGCGPIO
                               EQU              0x400FE608
   13 00000000         
   14 00000000 40004420 
                       GPIOA_AFSEL
                               EQU              0x40004420
   15 00000000 4000452C 
                       GPIOA_PCTL
                               EQU              0x4000452C
   16 00000000 4000451C 
                       GPIOA_DEN
                               EQU              0x4000451C
   17 00000000 40004400 
                       GPIOA_DIR
                               EQU              0x40004400
   18 00000000 400043FC 
                       GPIOA_DATA
                               EQU              0x400043FC
   19 00000000         
   20 00000000 40008000 
                       SSI0_CR0
                               EQU              0x40008000
   21 00000000 40008004 
                       SSI0_CR1
                               EQU              0x40008004
   22 00000000 40008010 
                       SSI0_CPSR
                               EQU              0x40008010
   23 00000000 40008008 
                       SSI0_DR EQU              0x40008008
   24 00000000 4000800C 
                       SSI0_SR EQU              0x4000800C
   25 00000000         
   26 00000000                 AREA             |.text|, READONLY, CODE, ALIGN=
2
   27 00000000                 EXPORT           init_screen
   28 00000000                 THUMB
   29 00000000         
   30 00000000         ; 1. initialize SSI module
   31 00000000         ; 2. pull down RST for some cycles, pull up
   32 00000000         ; 3. set H=1,V=0: send 0b00100001, DC=0
   33 00000000         ; 4. set Vop=5V: send 0b11000000
   34 00000000         ; 5. set TempC=3: send 0b00000111
   35 00000000         ; 6. set 0x13 for Vbias for some reason.
   36 00000000         ; 7. set H=0,V=0: send 0b00100000



ARM Macro Assembler    Page 2 


   37 00000000         ; 8. set D=0,E=1(normal display): send 0b00001100
   38 00000000         ; 9. set DC to 1 after now
   39 00000000         ; 10. send some dummy data to demonstrate
   40 00000000         init_screen
   41 00000000 B500            PUSH             {LR}
   42 00000002 F000 F866       BL               init_ssi_gpio
   43 00000006         
   44 00000006 494D            LDR              R1, =GPIOA_DATA
   45 00000008 6808            LDR              R0, [R1]
   46 0000000A F020 0080       BIC              R0, #0x80
   47 0000000E 6008            STR              R0, [R1]
   48 00000010         
   49 00000010 4D4B            LDR              R5, =100000
   50 00000012 1E6D    L       SUBS             R5, R5, #1
   51 00000014 D1FD            BNE              L
   52 00000016         
   53 00000016 F040 0080       ORR              R0, #0x80
   54 0000001A 6008            STR              R0, [R1]
   55 0000001C         
   56 0000001C F020 0040       BIC              R0, #0x40
   57 00000020 6008            STR              R0, [R1]
   58 00000022         
   59 00000022 F04F 0021       MOV              R0, #0x21
   60 00000026 F000 F84C       BL               send_spi_byte
   61 0000002A F04F 00C0       MOV              R0, #0xC0
   62 0000002E F000 F848       BL               send_spi_byte
   63 00000032 F04F 0007       MOV              R0, #0x07
   64 00000036 F000 F844       BL               send_spi_byte
   65 0000003A F04F 0013       MOV              R0, #0x13
   66 0000003E F000 F840       BL               send_spi_byte
   67 00000042         
   68 00000042 F04F 0020       MOV              R0, #0x20
   69 00000046 F000 F83C       BL               send_spi_byte
   70 0000004A F04F 000C       MOV              R0, #0x0C
   71 0000004E F000 F838       BL               send_spi_byte
   72 00000052 F04F 0040       MOV              R0, #0x40
   73 00000056 F000 F834       BL               send_spi_byte
   74 0000005A         
   75 0000005A 4938            LDR              R1, =GPIOA_DATA
   76 0000005C 6808            LDR              R0, [R1]
   77 0000005E F040 0040       ORR              R0, #0x40
   78 00000062 6008            STR              R0, [R1]
   79 00000064         
   80 00000064 F04F 001F       MOV              R0, #0x1F
   81 00000068 F000 F82B       BL               send_spi_byte
   82 0000006C F04F 0005       MOV              R0, #0x05
   83 00000070 F000 F827       BL               send_spi_byte
   84 00000074 F04F 0007       MOV              R0, #0x07
   85 00000078 F000 F823       BL               send_spi_byte
   86 0000007C F04F 0000       MOV              R0, #0x00
   87 00000080 F000 F81F       BL               send_spi_byte
   88 00000084 F04F 001D       MOV              R0, #0x1D
   89 00000088 F000 F81B       BL               send_spi_byte
   90 0000008C F04F 0000       MOV              R0, #0x00
   91 00000090 F000 F817       BL               send_spi_byte
   92 00000094 F04F 001F       MOV              R0, #0x1F
   93 00000098 F000 F813       BL               send_spi_byte
   94 0000009C F04F 0005       MOV              R0, #0x05
   95 000000A0 F000 F80F       BL               send_spi_byte



ARM Macro Assembler    Page 3 


   96 000000A4 F04F 0007       MOV              R0, #0x07
   97 000000A8 F000 F80B       BL               send_spi_byte
   98 000000AC F04F 0000       MOV              R0, #0x00
   99 000000B0 F000 F807       BL               send_spi_byte
  100 000000B4 F04F 001D       MOV              R0, #0x1D
  101 000000B8 F000 F803       BL               send_spi_byte
  102 000000BC         
  103 000000BC F85D EB04       POP              {LR}
  104 000000C0 4770            BX               LR
  105 000000C2         
  106 000000C2         ; put byte in FIFO, wait until SSI is idle
  107 000000C2         ; takes byte in R0
  108 000000C2         send_spi_byte
  109 000000C2 4920            LDR              R1, =SSI0_DR
  110 000000C4 6008            STR              R0, [R1]
  111 000000C6 4920            LDR              R1, =SSI0_SR
  112 000000C8 6808    L2      LDR              R0, [R1]
  113 000000CA F010 0010       ANDS             R0, R0, #0x10
  114 000000CE D1FB            BNE              L2
  115 000000D0 4770            BX               LR
  116 000000D2         
  117 000000D2         ; 1. initialize SSI clock
  118 000000D2         ; 2. initialize GPIO clock
  119 000000D2         ; 3. AFSEL for PA[5:2]: 0b00111100
  120 000000D2         ; 4. fn 2(SSI) for PA[5:2]: 0x00222200
  121 000000D2         ; X. maybe add pull-up resistors?
  122 000000D2         ; 5. DEN for PA[7:2]. we use PA7 for RST, PA6 for DC.
  123 000000D2         ; 6. DIR for PA[7:2]: 0b11101100, bit 4 is RX.
  124 000000D2         ; 7. disable SSI0: clear SSE bit of CR1
  125 000000D2         ; 8. put SSI0 into master mode: clear MS bit of CR1
  126 000000D2         ; 9. we want to set SCLK to 4MHz. divisor in CPSR is 4.
  127 000000D2         ; 10. configure CR0 with Freescale and 8-bit data 
  128 000000D2         ; 11. enable SSI0: set SSE bit of CR1
  129 000000D2         init_ssi_gpio
  130 000000D2 491E            LDR              R1, =RCGCSSI
  131 000000D4 6808            LDR              R0, [R1]
  132 000000D6 F040 0001       ORR              R0, #0x01
  133 000000DA 6008            STR              R0, [R1]
  134 000000DC         check_ssi
  135 000000DC 491C            LDR              R1, =PRSSI
  136 000000DE 6808            LDR              R0, [R1]
  137 000000E0 F010 0001       ANDS             R0, R0, #0x01
  138 000000E4 D0FA            BEQ              check_ssi
  139 000000E6         
  140 000000E6 491B            LDR              R1, =RCGCGPIO
  141 000000E8 6808            LDR              R0, [R1]
  142 000000EA F040 0001       ORR              R0, #0x01
  143 000000EE 6008            STR              R0, [R1]
  144 000000F0 BF00            NOP
  145 000000F2 BF00            NOP
  146 000000F4 BF00            NOP
  147 000000F6         
  148 000000F6 4918            LDR              R1, =GPIOA_AFSEL
  149 000000F8 F04F 003C       MOV              R0, #0x3C
  150 000000FC 6008            STR              R0, [R1]
  151 000000FE 4917            LDR              R1, =GPIOA_PCTL
  152 00000100 4817            LDR              R0, =0x00222200
  153 00000102 6008            STR              R0, [R1]
  154 00000104 4917            LDR              R1, =GPIOA_DEN



ARM Macro Assembler    Page 4 


  155 00000106 F04F 00FC       MOV              R0, #0xFC
  156 0000010A 6008            STR              R0, [R1]
  157 0000010C 4916            LDR              R1, =GPIOA_DIR
  158 0000010E F04F 00EC       MOV              R0, #0xEC
  159 00000112 6008            STR              R0, [R1]
  160 00000114         
  161 00000114 4915            LDR              R1, =SSI0_CR1
  162 00000116 6808            LDR              R0, [R1]
  163 00000118 F020 0006       BIC              R0, #0x06
  164 0000011C 6008            STR              R0, [R1]
  165 0000011E 4914            LDR              R1, =SSI0_CPSR
  166 00000120 F04F 0040       MOV              R0, #0x40
  167 00000124 6008            STR              R0, [R1]
  168 00000126 4913            LDR              R1, =SSI0_CR0
  169 00000128 F04F 0007       MOV              R0, #0x07
  170 0000012C 6008            STR              R0, [R1]
  171 0000012E 490F            LDR              R1, =SSI0_CR1
  172 00000130 6808            LDR              R0, [R1]
  173 00000132 F040 0002       ORR              R0, #0x02
  174 00000136 6008            STR              R0, [R1]
  175 00000138         
  176 00000138 4770            BX               LR
  177 0000013A         
  178 0000013A                 END
              00 00 400043FC 
              000186A0 
              40008008 
              4000800C 
              400FE61C 
              400FEA1C 
              400FE608 
              40004420 
              4000452C 
              00222200 
              4000451C 
              40004400 
              40008004 
              40008010 
              40008000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M4.fp --apcs=int
erwork --depend=.\objects\screen.d -o.\objects\screen.o -I.\RTE\_Target_1 -IC:\
Keil_v5\ARM\PACK\Keil\TM4C_DFP\1.1.0\Device\Include\TM4C123 -IC:\Keil_v5\ARM\CM
SIS\Include --predefine="__EVAL SETA 1" --predefine="__UVISION_VERSION SETA 526
" --predefine="TM4C123GH6PM SETA 1" --list=.\listings\screen.lst ..\screen.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 26 in file ..\screen.s
   Uses
      None
Comment: .text unused
L 00000012

Symbol: L
   Definitions
      At line 50 in file ..\screen.s
   Uses
      At line 51 in file ..\screen.s
Comment: L used once
L2 000000C8

Symbol: L2
   Definitions
      At line 112 in file ..\screen.s
   Uses
      At line 114 in file ..\screen.s
Comment: L2 used once
check_ssi 000000DC

Symbol: check_ssi
   Definitions
      At line 134 in file ..\screen.s
   Uses
      At line 138 in file ..\screen.s
Comment: check_ssi used once
init_screen 00000000

Symbol: init_screen
   Definitions
      At line 40 in file ..\screen.s
   Uses
      At line 27 in file ..\screen.s
Comment: init_screen used once
init_ssi_gpio 000000D2

Symbol: init_ssi_gpio
   Definitions
      At line 129 in file ..\screen.s
   Uses
      At line 42 in file ..\screen.s
Comment: init_ssi_gpio used once
send_spi_byte 000000C2

Symbol: send_spi_byte
   Definitions
      At line 108 in file ..\screen.s
   Uses
      At line 60 in file ..\screen.s
      At line 62 in file ..\screen.s
      At line 64 in file ..\screen.s
      At line 66 in file ..\screen.s
      At line 69 in file ..\screen.s



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

      At line 71 in file ..\screen.s
      At line 73 in file ..\screen.s
      At line 81 in file ..\screen.s
      At line 83 in file ..\screen.s
      At line 85 in file ..\screen.s
      At line 87 in file ..\screen.s
      At line 89 in file ..\screen.s
      At line 91 in file ..\screen.s
      At line 93 in file ..\screen.s
      At line 95 in file ..\screen.s
      At line 97 in file ..\screen.s
      At line 99 in file ..\screen.s
      At line 101 in file ..\screen.s

7 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

GPIOA_AFSEL 40004420

Symbol: GPIOA_AFSEL
   Definitions
      At line 14 in file ..\screen.s
   Uses
      At line 148 in file ..\screen.s
Comment: GPIOA_AFSEL used once
GPIOA_DATA 400043FC

Symbol: GPIOA_DATA
   Definitions
      At line 18 in file ..\screen.s
   Uses
      At line 44 in file ..\screen.s
      At line 75 in file ..\screen.s

GPIOA_DEN 4000451C

Symbol: GPIOA_DEN
   Definitions
      At line 16 in file ..\screen.s
   Uses
      At line 154 in file ..\screen.s
Comment: GPIOA_DEN used once
GPIOA_DIR 40004400

Symbol: GPIOA_DIR
   Definitions
      At line 17 in file ..\screen.s
   Uses
      At line 157 in file ..\screen.s
Comment: GPIOA_DIR used once
GPIOA_PCTL 4000452C

Symbol: GPIOA_PCTL
   Definitions
      At line 15 in file ..\screen.s
   Uses
      At line 151 in file ..\screen.s
Comment: GPIOA_PCTL used once
PRSSI 400FEA1C

Symbol: PRSSI
   Definitions
      At line 11 in file ..\screen.s
   Uses
      At line 135 in file ..\screen.s
Comment: PRSSI used once
RCGCGPIO 400FE608

Symbol: RCGCGPIO
   Definitions
      At line 12 in file ..\screen.s
   Uses
      At line 140 in file ..\screen.s
Comment: RCGCGPIO used once
RCGCSSI 400FE61C




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

Symbol: RCGCSSI
   Definitions
      At line 10 in file ..\screen.s
   Uses
      At line 130 in file ..\screen.s
Comment: RCGCSSI used once
SSI0_CPSR 40008010

Symbol: SSI0_CPSR
   Definitions
      At line 22 in file ..\screen.s
   Uses
      At line 165 in file ..\screen.s
Comment: SSI0_CPSR used once
SSI0_CR0 40008000

Symbol: SSI0_CR0
   Definitions
      At line 20 in file ..\screen.s
   Uses
      At line 168 in file ..\screen.s
Comment: SSI0_CR0 used once
SSI0_CR1 40008004

Symbol: SSI0_CR1
   Definitions
      At line 21 in file ..\screen.s
   Uses
      At line 161 in file ..\screen.s
      At line 171 in file ..\screen.s

SSI0_DR 40008008

Symbol: SSI0_DR
   Definitions
      At line 23 in file ..\screen.s
   Uses
      At line 109 in file ..\screen.s
Comment: SSI0_DR used once
SSI0_SR 4000800C

Symbol: SSI0_SR
   Definitions
      At line 24 in file ..\screen.s
   Uses
      At line 111 in file ..\screen.s
Comment: SSI0_SR used once
13 symbols
356 symbols in table
